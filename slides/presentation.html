<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Power Catch-up: Everything Practical and Important in Manticore</title><meta name="author" content="李沫南 @nzinfo"><link rel="stylesheet" href="reveal.js/css/reset.css"><link rel="stylesheet" href="reveal.js/css/reveal.css"><link rel="stylesheet" href="css/sky.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right{float:right}

/* listing block */
.reveal .listingblock.stretch>.content{height: 100%}
.reveal .listingblock.stretch>.content>pre{height: 100%}
.reveal .listingblock.stretch>.content>pre>code{height:100%;max-height:100%}

/* tables */
table{border-collapse:collapse;border-spacing:0}
table{margin-bottom:1.25em;border:solid 1px #dedede}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
td.tableblock>.content{margin-bottom:1.25em}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
.reveal table th.halign-left,.reveal table td.halign-left{text-align:left}
.reveal table th.halign-right,.reveal table td.halign-right{text-align:right}
.reveal table th.halign-center,.reveal table td.halign-center{text-align:center}
.reveal table th.valign-top,.reveal table td.valign-top{vertical-align:top}
.reveal table th.valign-bottom,.reveal table td.valign-bottom{vertical-align:bottom}
.reveal table th.valign-middle,.reveal table td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{font-weight:bold}
thead{display:table-header-group}

.reveal table.grid-none th,.reveal table.grid-none td{border-bottom:0!important}

/* kbd macro */
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
/* Callout list */
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table{border: 0}
/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist>table th, .reveal .colist>table td {border-bottom:0}
/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td{line-height:inherit}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
  padding: .75rem;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}
</style><link rel="stylesheet" href="./fonts/fontawesome/css/all.css"><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js/css/print/pdf.css" : "reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><link rel="stylesheet" href="css/presentation.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Power Catch-up</h1><h2>Everything Practical and Important in Manticore</h2><div class="preamble"><aside class="notes"><div class="ulist"><ul><li><p>Some note here.</p></li></ul></div></aside></div><p class="author"><small>李沫南 @nzinfo</small></p></section>
<section id="_history" class="lightbg" data-background-image="images/manuscript.jpg"><h2>History</h2><div class="slide-content"><div class="ulist"><ul><li><p>2001  作为 Andrew Aksyonoff 的个人项目</p></li><li><p>2008  Sphinx Technologies Inc 成立</p></li><li><p>2008  Coreseek 成立</p></li><li><p>2016  开发团队分裂， Sphinx 转为闭源项目</p></li><li><p>2017  作为 Manticore Search</p></li></ul></div></div></section>
<section><section id="_elastic_vs_sphinx"><h2>Elastic VS Sphinx</h2><div class="slide-content"><div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">JVM Based</div><ul><li><p>优点</p><div class="ulist"><ul><li><p>可移植性高</p></li><li><p>Hotspot 即时编译</p></li></ul></div></li><li><p>缺点</p><div class="ulist"><ul><li><p>内存消耗高</p></li><li><p>每次启动需要即时编译</p></li></ul></div></li></ul></div>
<div class="ulist"><div class="title">Usage</div><ul><li><p>索引</p><div class="ulist"><ul><li><p>HTTP 接口</p></li><li><p>无需预设索引结构</p></li></ul></div></li><li><p>查询</p><div class="ulist"><ul><li><p>HTTP 接口</p></li><li><p>HTTP 接口 ，带 SQL 扩展</p></li><li><p>用户自定义排序公式</p></li></ul></div></li></ul></div></div></div><div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">Native Code</div><ul><li><p>优点</p><div class="ulist"><ul><li><p>内存占用低</p></li><li><p>启动速度快</p></li><li><p>便于利用操作系统的特性</p></li></ul></div></li><li><p>缺点</p><div class="ulist"><ul><li><p>出错，服务即崩溃</p></li><li><p>难以根据应用做进一步优化</p></li></ul></div></li></ul></div>
<div class="ulist"><div class="title">Usage</div><ul><li><p>索引</p><div class="ulist"><ul><li><p>CLI | Socket API | MySQL | HTTP 接口</p></li><li><p>需要预设索引结构, 支持 JSON 和 <strong>Schema On Read</strong></p></li></ul></div></li><li><p>查询</p><div class="ulist"><ul><li><p>Socket API | MySQL | HTTP 接口</p></li><li><p>用户自定义排序公式</p></li></ul></div></li></ul></div></div></div></div></section><section id="_elastic_vs_sphinx_2"><h2>Elastic VS Sphinx</h2><div class="slide-content"><div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">Cluster</div><ul><li><p>自动横向扩展</p></li><li><p>自动同步</p></li><li><p>集群热备</p></li><li><p>监控接口丰富</p></li></ul></div>
<div class="ulist"><div class="title">Integration</div><ul><li><p>HTTP 接口</p></li><li><p>可视化 Kibana</p></li></ul></div>
<div class="ulist"><div class="title">Format</div><ul><li><p>可扩展索引结构</p></li><li><p>使用了较新的倒排算法</p></li><li><p>默认启用压缩</p></li><li><p>需要额外的缓存 (Before 7.7)</p><div class="ulist"><ul><li><p>FileSystem Cache , 1/2 Total RAM</p></li></ul></div></li></ul></div></div></div>
<div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">Cluster</div><ul><li><p>手动横向扩展</p></li><li><p>支持数据同步（手动配置）</p></li><li><p>集群热备</p></li><li><p>有一定的监控能力</p></li></ul></div>
<div class="ulist"><div class="title">Integration</div><ul><li><p>HTTP 接口</p></li><li><p>MySQL 接口</p></li><li><p>支持 SQL 的可视化工具</p></li></ul></div>
<div class="ulist"><div class="title">Format</div><ul><li><p>扩展索引结构困难</p></li><li><p>倒排压缩算法较传统（旧）</p></li><li><p>默认仅正排索引压缩</p></li><li><p>对 缓存 的需求低</p></li></ul></div></div></div></div></section><section id="_mmap_in_elastic" class="bonuscontent"><h2>MMap in ELASTIC</h2><div class="slide-content"><div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">index.store.type</div><ul><li><p>niofs</p></li><li><p>mmapfs</p></li><li><p>hybridfs</p></li></ul></div>
<div class="ulist"><div class="title">OOM?</div><ul><li><p>vm.max_map_count</p></li><li><p>MMAP readahead</p></li><li><p>jhat 命令</p></li><li><p><code>syscall</code> madvise()</p></li></ul></div></div></div>
<div class="listingblock source col2"><div class="title">hybridfs</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">switch(extension) {
    case "nvd":
    case "dvd":
    case "tim":
    case "tip":
    case "cfs":
        return true;
    default:
        return false;
}</code></pre></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://www.cnblogs.com/naughtycat/p/elasticsearch-oom-optimize-story.html">记一次Elasticsearch OOM（内存溢出）的优化过程</a></p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html">Virtual memory</a></p></li><li><p><a href="https://elasticsearch.cn/article/754">Mmap fs可能让大索引访问变得缓慢</a></p></li><li><p><a href="https://medium.com/@brk0v/mmap-readahead-linux-internals-d96b8fbef202">MMAP readahead Linux internals</a></p></li><li><p><a href="https://www.usenix.org/sites/default/files/conference/protected-files/hotstorage17_slides_choi.pdf">Efficient Memory Mapped File I/O
for In-Memory File Systems</a></p></li><li><p><a href="https://github.com/elastic/elasticsearch/issues/27748">Avoid file cache trashing on Linux with mmapfs by using madvise() </a></p></li><li><p><a href="https://www.elastic.co/cn/blog/significantly-decrease-your-elasticsearch-heap-memory-usage">Coming in 7.7: Significantly decrease your Elasticsearch heap&#8230;&#8203;</a></p></li><li><p><a href="https://www.easyice.cn/archives/346">ELASTICSEARCH 7.3 的 OFFHEAP 原理</a></p></li></ul></div></div></div></div></section></section>
<section id="_agenda" class="lightbg" data-background-video="videos/woman-study.mp4" data-background-video-loop data-background-opacity="0.5"><h2>Agenda</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>How to access</p></li><li><p>Index Building</p></li><li><p>Query</p></li><li><p>Index Management</p></li></ol></div>
<aside class="notes"><div class="paragraph"><p>While you lean back and take a beer, I&#8217;ll …</p></div>
<div class="paragraph"><p>&#160;<br>
<span class="decent"><span class="icon"><i class="fa fa-hand-point-right"></i></span> v12+ &amp; Preview Features:</span> <span class="version">12</span> <span class="version">13</span> <span class="preview">preview</span></p></div></aside></div></section>
<section><section id="_access_manticore" class="lightbg" data-background-video="videos/flowers.mp4" data-background-video-loop data-background-opacity="0.7"><h2>Access Manticore</h2></section><section id="_sphinx_api"><h2>Sphinx API</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Java module (Jigsaw)</strong></p></li><li><p><strong>API Improvements:</strong> <em>Project Coin Milling</em>, Stream, …</p></li><li><p><strong>Unified JVM &amp; Java Logging</strong>, …</p></li><li><p><strong>Performance</strong></p></li><li><p><em>Tools:</em> <code>jshell</code> <code>jlink</code> <code>-release</code>, Multi-Release JARs</p></li></ul></div>
<div class="paragraph"><p><span class="decent">2017-03-23, <span class="icon"><i class="fa fa-exclamation-circle"></i></span> <a href="http://openjdk.java.net/projects/jdk9/"><strong>91</strong> JEPs</a></span></p></div>
<aside class="notes"><div class="paragraph"><p>The <strong>biggest</strong> release of all.</p></div>
<div class="ulist"><ul><li><p>Mostly modular JRE &amp; accompagning tools</p></li><li><p>Many helpful API enhancements</p></li><li><p>…and <strong>Performance</strong> enhancements!</p></li></ul></div></aside></div></section><section id="_sphinxql"><h2>SphinxQL</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>var</code>: <strong>Local-Variable Type Inference</strong></p></li><li><p><strong>Performance</strong>: GC, Class-Data Sharing, Threads, …</p></li><li><p><em>Experimental:</em> <strong>Graal AoT-Compiler</strong></p></li></ul></div>
<div class="paragraph"><p><span class="decent">2018-03-20, <a href="http://openjdk.java.net/projects/jdk/10/">12 JEPs</a></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p><code>var</code>: really noteable feature</p></li><li><p>…and <strong>Performance!</strong></p></li></ul></div></aside></div></section><section id="_sphinxse"><h2>SphinxSE</h2><div class="slide-content"><div class="ulist"><ul><li><p>New <strong>HTTP/2- &amp; Websocket</strong>-Client</p></li><li><p><strong>New GCs</strong>: Low-latency ZGC, No-op Epsiolon GC</p></li><li><p><strong>Ex-payware:</strong> <strong>Flight Recorder</strong>, ZGC, CDS, …<br>
→ Oracle JDK ≌ OpenJDK</p></li><li><p><strong>Dropped:</strong> Java EE, JavaFX, CORBA</p></li><li><p>HTML5 Javadoc, <strong>Unicode 10</strong>, …</p></li><li><p><strong>Updated Crypto</strong>: TLS 1.3, new Kex &amp; Ciphers</p></li></ul></div>
<div class="paragraph"><p><span class="decent">2018-09-25, <a href="http://openjdk.java.net/projects/jdk/11/">17 JEPs</a></span></p></div>
<aside class="notes"><div class="ulist"><div class="title">Polishing &amp; Cleanup release</div><ul><li><p>Many cleanups like dropping EE, JavaFX, CORBA</p></li><li><p>Payware → FOSS</p></li><li><p>New GCs which improve… <strong>Performance</strong></p></li></ul></div></aside></div></section><section id="_http_api"><h2>HTTP API</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Low-pause GC</strong> „Shenandoah“</p></li><li><p><strong>Microbenchmark Suite</strong></p></li><li><p><em>Preview:</em> Switch Expressions</p></li><li><p><strong>Performance</strong> improvements<br>
<span class="verydecent">(CDS, G1 GC, Constants)</span></p></li></ul></div>
<div class="paragraph"><p><span class="decent">2019-03-19, <a href="http://openjdk.java.net/projects/jdk/12/">8 JEPs</a></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Switch Preview … stays Preview in 13</p></li><li><p>Again: <strong>Performance, Performance, Performance…</strong></p></li></ul></div></aside></div></section><section id="_v13"><h2>v13</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>Updated Preview:</em>  <strong>Switch-Expression</strong></p></li><li><p><em>Preview:</em> <strong>Text Blocks</strong></p></li><li><p><strong>Performance</strong> improvements<br>
<span class="verydecent">(AppCDS, ZGC, Socket)</span></p></li></ul></div>
<div class="paragraph"><p><span class="icon"><i class="fa fa-calendar-alt"></i></span> <span class="decent">2019-09-17, <a href="http://openjdk.java.net/projects/jdk/12/">5 JEPs</a></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Even more playstuff! Adding Text blocks</p></li><li><p>Again: Performance!</p></li></ul></div></aside></div></section></section>
<section><section id="_language" class="lightbg" data-background-video="videos/woman-study.mp4" data-background-video-loop data-background-opacity="0.7"><h2>Language</h2></section><section id="_local_variable_type_inference_jep_286"><h2>Local Variable Type Inference <span class="jep"><a href="https://openjdk.java.net/jeps/286">JEP 286</a></span></h2><div class="slide-content"><div class="openblock col2"><div class="content"><div class="ulist"><ul><li><p>New reserved Java type <code>var</code></p></li><li><p><em>„real type“</em> inferred by compiler <strong>on first initialization</strong></p></li><li><p>can denote classes (<code>Integer</code>) &amp; primitives (<code>int</code>)</p></li><li><p><strong>only</strong>  available for <em>local variables</em></p></li></ul></div></div></div>
<div class="listingblock source col2"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var primitiveVal = 5;   // int
var doubleVal    = 5d;  // double

final var sl = new ArrayList&lt;String&gt;();

var letters = "";
for (var s : sl) {
    letters += s.toLowerCase();
}

// var: enable annotation w/ type infer
(var x, @NotNull var y) -&gt; x + y;</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Especially helpful for Generic Type madness <code>List&lt;? extends Foo&lt;? extends Number&gt;&gt;</code>…</p></li><li><p><strong>first initialization</strong> → Type!</p></li><li><p>only vars</p></li></ul></div>
<div class="paragraph"><p>Really a beauty</p></div></aside></div></section><section id="_type_inferencebordercases" class="degrade"><h2>Type Inference&#8201;&#8212;&#8201;Bordercases</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">// var wontCompile; <i class="conum" data-value="1"></i><b>(1)</b>
// var wontCompile = null;
// var wontCompile = {-1, 1};

var myMap = new HashMap&lt;&gt;();
myMap.put(42, "The answer");
// var wontCompile = myMap.get(42).trim(); <i class="conum" data-value="2"></i><b>(2)</b>

// var wontCompile = String::toUpperCase; <i class="conum" data-value="3"></i><b>(3)</b>

var myPredicate = new IntPredicate() {
    public boolean test(int value) {  return value &gt; 0; }  };
// myPredicate = (int i) -&gt; (i % 2) == 0; <i class="conum" data-value="4"></i><b>(4)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Type <em>must be inferrable</em> – no late init, <code>null</code> or array literals</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Type <em>inferred at declaration</em> time: <code>Map&lt;Object, Object&gt;</code></td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td><em>Method references</em> must be explicit</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td><em>Anonymous Types</em> are types-per-instance; therefore no reassignment</td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>Type <em>must be inferrable</em> – no late init, <code>null</code> or array literals</p></li><li><p>Type <em>inferred at declaration</em> time: <code>Map&lt;Object, Object&gt;</code></p></li><li><p><em>Method references</em> must be explicit</p></li><li><p><em>Anonymous Types</em> are types-per-instance; therefore no reassignment</p></li></ul></div></aside></div></section><section id="_lambda_type_inference_jep_323" class="bonuscontent"><h2>Lambda Type inference <span class="jep"><a href="https://openjdk.java.net/jeps/323">JEP 323</a></span></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">// JDK8
MyLambda myLambda = (x, y) -&gt; x + ((y != null) ? y : 0);
myLambda = (Long x, @NotNull Long y) -&gt; x + y;

// JDK11: `var` style → type infer with annotations
myLambda = (var x, @NotNull var y) -&gt; x + y;</code></pre></div></div></div></section><section id="_type_inference_styleguide"><h2>Type inference: Styleguide</h2><div class="slide-content"><div class="videoblock stretch"><video src="videos/type-infer-styleguide.mp4" width="100%" height="100%" poster="images/Style%20Guidelines%20for%20Local%20Variable%20Type%20Inference%20in%20Java" controls>Your browser does not support the video tag.</video></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="http://openjdk.java.net/projects/amber/LVTIstyle.html">Style Guidelines for Local Variable Type Inference in Java</a></p></li></ul></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>May hide things: Project wrote a styleguide with recommendations</p></li><li><p>Don&#8217;t make source-code reading a puzzle</p></li></ul></div></aside></div></section><section id="_milling_project_coin_jep_213"><h2>Milling Project Coin <span class="jep"><a href="https://openjdk.java.net/jeps/213">JEP 213</a></span></h2><div class="slide-content"><div class="listingblock"><div class="title">Try-with-resources now support „effectively final“ variables</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var inputStream = new FileInputStream(".gitignore");
try (inputStream) { … }</code></pre></div></div>
<div class="openblock tgap fragment"><div class="content"><div class="listingblock"><div class="title">Private methods in Interfaces</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">interface Version {
    byte[] digits();
    default String text() { return text(digits()); }
    private String text(byte[] version) { … }
}</code></pre></div></div>
<div class="paragraph"><p><span class="verydecent">Allows default methods share common code</span></p></div></div></div>
<aside class="notes"><div class="paragraph"><p>Milling Project Coin: A long runner project. Continously delivering small enhancement changes to Java</p></div></aside></div></section><section id="_milling_project_coin" class="bonuscontent"><div class="slide-content"><div class="listingblock"><div class="title">Diamond operator for anonymous inner classes</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">Comparator&lt;Integer&gt; compareLongs = new Comparator&lt;&gt;() { … }</code></pre></div></div>
<div class="openblock tgap fragment"><div class="content"><div class="listingblock"><div class="title"><code>@SafeVargs</code> on private instance methods</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">private List&lt;String&gt; safeVarargsMethod(List&lt;String&gt;... lists) { … }</code></pre></div></div></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p>(1) <a href="https://www.javaworld.com/article/3169388/java-9s-other-new-enhancements-part-2.html">Java 9&#8217;s other new enhancements, Part 2: Milling Project Coin</a></p></li></ul></div></div></div></div></section><section id="_preview_features_preview_12"><h2>Preview features <span class="preview">Preview</span> <span class="version">12</span></h2><div class="slide-content"><div class="openblock col2"><div class="content"><div class="listingblock"><div class="title">Unlock Compilation</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs" data-noescape="true">javac --release xx --enable-preview</code></pre></div></div></div></div>
<div class="openblock col2"><div class="content"><div class="listingblock"><div class="title">Unlock Execution</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs" data-noescape="true">java --enable-preview …</code></pre></div></div></div></div>
<div class="openblock clear"><div class="content"><div class="paragraph"><p> <br>
<span class="decent"><code>xx</code> must <em>exactly</em> match used JDK version</span></p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>New in Java 12</p></li><li><p>Allow to preview/use features.</p></li><li><p>Forces awareness by using toggle switch on <em>compiling and running</em></p></li></ul></div></aside></div></section><section id="_switch_in_java_8" data-transition="fade-out"><h2><code>switch</code> in Java 8</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">    enum Direction {N, S, W, E}

    String switchExpressionJDK8(Direction way) {
        String result;
        switch (way) {
            case N:
                result = "Up";
                break;
            case S:
                result = "Down";
                break;
            case E:
            case W:
                result = "Somewhere left or right";
                break;
            default:
                throw new IllegalStateException("Huh?: " + way);
        }
        return result;
    }</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Error-prone</p><div class="ulist"><ul><li><p>forget <code>break</code></p></li><li><p>must have a <code>default</code></p></li></ul></div></li><li><p>Clumsy: Temporary assign a variable</p></li></ul></div></aside></div></section><section id="_switch_expression_jep_325_12_jep_354_13_preview" data-transition="fade-in"><h2>Switch-Expression <span class="jep"><a href="https://openjdk.java.net/jeps/325">JEP 325</a></span> <span class="version">12</span> <span class="jep"><a href="https://openjdk.java.net/jeps/354">JEP 354</a></span> <span class="version">13</span> <span class="preview">Preview</span></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">String switchExpressionPreview13(Direction way) {
    return switch (way) {                         <i class="conum" data-value="1"></i><b>(1)</b>
        case N -&gt; "Up";                           <i class="conum" data-value="2"></i><b>(2)</b>
        case S -&gt; { yield "Down"; }               <i class="conum" data-value="3"></i><b>(3)</b>
        case E, W -&gt; "Somewhere left or right";
        // default -&gt; "Foo"                       <i class="conum" data-value="4"></i><b>(4)</b>
    };
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>switch</code> can be used as expression</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td><code>&#8594;</code> instead of <code>:</code> → no <code>break;</code> necessary!</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Lambdas can be used to. For <em>expressions</em> they must <code>yield</code> a value <span class="version">13</span></td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td><code>default</code> can be ommitted if a) no expression or b) <code>enum</code> with every value handled</td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>Preview kommt durchaus zum Einsatz:  Switch-Expression wurde mit Java 12 eingeführt und in Java 13 verändert.</p></li><li><p><code>switch</code> can be used as expression</p></li><li><p><code>&#8594;</code> instead of <code>:</code> → no <code>break;</code> necessary!</p></li><li><p>Lambdas can be used to. For <em>expressions</em> they must <code>yield</code> a value <span class="version">13</span>
+ <code>default</code> can be ommitted if a) no expression or b) <code>enum</code> with every value handled</p></li></ul></div></aside></div></section><section id="_text_blocks_jep_355_13_preview"><h2>Text Blocks <span class="jep"><a href="https://openjdk.java.net/jeps/355">JEP 355</a></span> <span class="version">13</span> <span class="preview">Preview</span></h2><div class="slide-content"><div class="openblock col2"><div class="content"><div class="listingblock"><div class="title">Java 8</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">Object obj = engine.eval(
    "function hello() {\n" +
    "   print(\"Hi, world!\");\n" +
    "}\n" +
    "\n"  +
    "hello();\n"
    );</code></pre></div></div></div></div>
<div class="openblock col2"><div class="content"><div class="listingblock"><div class="title">Java 13</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">Object obj = engine.eval("""
    function hello() {
       print("Hi, world!");
    }

    hello();
    """);</code></pre></div></div></div></div>
<div class="openblock small decent"><div class="content"><div class="ulist"><ul><li><p>Leading space-Character identation removed<br>
up to the most-left character in the block including the closing <code>"""</code></p></li><li><p>Normalizes line-endings to <code>\n</code> and removes all trailing white spaces</p></li></ul></div></div></div>
<aside class="notes"></aside></div></section><section id="_jigsaw_jep_201"><h2>Jigsaw <span class="jep"><a href="https://openjdk.java.net/jeps/201">JEP 201</a></span></h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Modules bundle together one or more packages
and offer stronger encapsulation than jars</p></div></blockquote></div>
<div class="ulist"><ul><li><p>Allows <strong>scaled-down runtime</strong>  &rarr; IoT &amp; Container</p></li><li><p><strong>Stronger:</strong> <code>public</code> invisible to other modules</p></li><li><p><em>Sad:</em> No module versioning</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Only briefly: Most of you will know</p></li><li><p><strong>1 package = 1 module</strong></p></li></ul></div></aside></div></section><section id="_jigsaw" data-transition="fade-out"><div class="slide-content"><div class="listingblock"><div class="title">Metadata: <code>/module-info.java</code>:</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">module com.mysql.jdbc {
    requires java.sql;             // Module dependency
    exports com.mysql.jdbc;        // Export module package → enables access
    provides java.sql.Driver       // SPI: Provide service instance
        with com.mysql.jdbc.Driver;
}</code></pre></div></div>
<div class="openblock tgap fragment"><div class="content"><div class="listingblock"><div class="title">Jigsaw uses modules &amp; <code>.jmod</code> instead of Classpath &amp; <code>.jar</code></div>
<div class="content"><pre>javac -mp modulepath ...
java  -mp modulepath -m modulename/moduleclass</pre></div></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Metadata described in <code>module-info.java</code></p></li><li><p><strong>Either-Or!</strong> You stay in classpath/JAR mode oder switch to modules /jmod</p></li></ul></div></aside></div></section><section id="_serviceloader_modules" class="bonuscontent"><h2><code>ServiceLoader</code> &amp; modules</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">public abstract class BillingService {
    public static BillingService getInstance() {
        return ServiceLoader.load(BillingService.class)
                .findFirst().orElseThrow();
    }

    public abstract String takeMyMoney();
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">public class MastercardBillingService extends BillingService { … }</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">module anothermodule {
    provides bentolor.BillingService
       with bentolor.MastercardBillingService;
}</code></pre></div></div>
<div class="paragraph"><p>→ Simply use via <code>BillingService.getInstance()</code></p></div></div></section><section id="_jigsaw_conclusion" data-transition="fade-in"><div class="slide-content"><div class="quoteblock"><blockquote>It is too early to say whether modules will achieve widespread
use outside of the JDK itself. In the meantime, it seems best to
avoid them unless you have a compelling need.</blockquote><div class="attribution"><cite>Effective Java: Third Edition (2018)</cite><br>&#8212; Joshua Bloch</div></div></div></section></section>
<section><section id="_api" class="lightbg" data-background-video="videos/keyboard.mp4" data-background-video-loop data-background-opacity="0.7"><h2>API</h2></section><section id="_immutable_collection_factories_jep_269"><h2>Immutable Collection Factories <span class="jep"><a href="https://openjdk.java.net/jeps/269">JEP 269</a></span></h2><div class="slide-content"><div class="listingblock"><div class="title"><code>List/Set/Map.of()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">/* Comment sections would break ... */
List&lt;Integer&gt; listOfNumbers     = List.of(1, 2, 3, 4, 5/*, null*/);

Set&lt;Integer&gt; setOfNumbers       = Set.of(1, 2, 3, 4, 5/*, 1*/);

Map&lt;String, String&gt; mapOfString = Map.of("key1", "value1", "key2", "value2");

Map&lt;String, String&gt; moreMaps    = Map.ofEntries(
        Map.entry("key1", "value1"),
        Map.entry("key2", "value2")/*,
        Map.entry("key1", "value3")*/
);</code></pre></div></div>
<div class="openblock decent"><div class="content"><div class="paragraph"><p>Produces <em>immutable</em> collections. All methods <em>fail on <code>null</code> values.</em> <br>
<code>Set.of()</code> and <code>Map.of()</code> break on <em>duplicate</em> (key) entries.</p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Long overdue. Sth. I always did on my own in nearly every project.</p></li></ul></div></aside></div></section><section id="_immutable_collection_copy"><h2>Immutable collection copy</h2><div class="slide-content"><div class="listingblock"><div class="title"><code>List/Set/Map.copyOf()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var listCopy = List.copyOf(originalList);  // independent, immutable copy
var setCopy  =  Set.copyOf(originalList);  // copy to other types
var mapCopy  =  Map.copyOf( … );

assert 3 == listCopy.size();  // ["a", "b", "a"]
assert 2 == setCopy.size();   // ["a", "b"]

// listCopy.add("z")          // → UnsupportedOperationException</code></pre></div></div>
<div class="openblock tgap small"><div class="content"><div class="paragraph"><p><span class="decent"><em>Real copies</em> – independent from source vs. <code>Collections.unmodifiable()</code></span></p></div></div></div></div></section><section id="_files_io"><h2>Files &amp; I/O</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var txtPath = Path.of("src", "test", "resources", "sample.txt");         <i class="conum" data-value="1"></i><b>(1)</b>
Path newPath = Path.of("src/test/resources/newfile.txt");

String fileContent = Files.readString(txtPath);                          <i class="conum" data-value="2"></i><b>(2)</b>
// → "Nostrum iure ullam."

Files.writeString(newPath, "Nostrum lore.", StandardOpenOption.CREATE);  <i class="conum" data-value="3"></i><b>(3)</b>

long firstMismatch = Files.mismatch(txtPath, newPath); // → 8  | JDK12   <i class="conum" data-value="4"></i><b>(4)</b></code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Directly create <code>Path</code>-instances</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Hassle-free reading a file content into a string</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>…or writing into files</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Find position of first mismatching bytes of two Files <span class="version">12</span></td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>Hassle-free reading a file content into a string or writing into files</p></li><li><p>Find position of first mismatching bytes of two Files <span class="version">12</span></p></li></ul></div></aside></div></section><section id="_stream_enhancements" class="bonuscontent"><h2>Stream Enhancements</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p><strong>Transform</strong> with <code>dropWhile()</code> &amp; <code>takeWhile()</code></p></li><li><p><strong>Generate</strong> with <code>iterate()</code> &amp; <code>ofNullable()</code>)</p></li><li><p><strong>Redirect</strong> with <code>transferTo()</code></p></li><li><p>Collect <strong>to immutables</strong> with <code>toUnmodifiableList()</code>,</p></li><li><p>… or <strong>invert</strong> filters with <code>Predicate.not()</code></p></li></ol></div></div></section><section id="_transform_generate_streams"><h2>Transform &amp; Generate Streams</h2><div class="slide-content"><div class="openblock fragment"><div class="content"><div class="listingblock"><div class="title">Modify with <code>dropWhile()</code> &amp; <code>takeWhile()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var stream = Stream.of(-1, 0, 1, 21, 42);

stream.dropWhile(i -&gt; i &lt; 2)     // → [ 21, 42   ]
stream.takeWhile(i -&gt; i &lt; 2)     // → [ -1, 0, 1 ]</code></pre></div></div></div></div>
<div class="openblock fragment"><div class="content"><div class="listingblock"><div class="title">Redirect with <code>transferTo()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">new ByteArrayInputStream(buf)
        .transferTo(System.out);    // InputStream → OutputStream</code></pre></div></div></div></div>
<div class="openblock fragment"><div class="content"><div class="listingblock"><div class="title">Generate with <code>iterate()</code> &amp; <code>ofNullable()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">// Stream&lt;T&gt; iterate​(seedValue, nextTest, applyFunc)
Stream.iterate(2, i -&gt; i &lt; 999,  i -&gt; i*i);     // → [2, 4, 16, 256]

Stream.ofNullable(null);                        // [ ]
Stream.ofNullable("Hi");                        // [ "Hi" ]</code></pre></div></div></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Werte anhand eines Filters überspringen oder begrenzen</p></li><li><p>Streams umleiten</p></li><li><p>Iterate-Stream oder Stream mit 0 oder 1 Element</p></li></ol></div></aside></div></section><section id="_collectors" class="left"><h2>Collectors</h2><div class="slide-content"><div class="listingblock"><div class="title">Dispatch a stream to two consuming Collectors with <code>teeing()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">double rms(Stream&lt;Integer&gt; numStream) {
    return rms = numStream.collect(
            Collectors.teeing(
                    Collectors.summingDouble(i -&gt; i * i),   // → sum
                    Collectors.counting(),                  // → n
                    (sum, n) -&gt; Math.sqrt(sum / n) // Join into final result
            )
    );
}</code></pre></div></div>
<div class="openblock tgap fragment small"><div class="content"><div class="ulist"><div class="title">More new <code>Collectors</code> goodness…</div><ul><li><p>Create immutable Stream copies with <code>toUnmodifiableList/set/Map()</code></p></li><li><p>unpack nested values using <code>flatMap()</code></p></li><li><p>filter out unwanted values using <code>filtering()</code></p></li></ul></div></div></div></div></section><section id="_predicatenot"><div class="slide-content"><div class="listingblock"><div class="title"><code>Predicate::not</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">stream.filter(s -&gt; !s.isEmpty)</code></pre></div></div>
<div class="openblock fragment"><div class="content"><div class="listingblock"><div class="title"><span class="icon"><i class="fa fa-angle-double-down"></i></span></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">stream.filter(Predicate.not(String::isEmpty))</code></pre></div></div></div></div>
<div class="openblock fragment"><div class="content"><div class="listingblock"><div class="title"><span class="icon"><i class="fa fa-angle-double-down"></i></span></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">stream.filter(not(String::isEmpty))</code></pre></div></div></div></div></div></section><section id="_enhanced_optional"><h2>Enhanced <code>Optional</code></h2><div class="slide-content"><div class="listingblock"><div class="title">New <code>ifPresentOrElse()</code>, <code>or()</code>, <code>stream()</code> and <code>isPresent()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var maybeInt = Optional.ofNullable( (Math.random()&lt;0.5) ? 42 : null );

maybeInt.ifPresentOrElse(                       // … do either this or that
        (n) -&gt; System.out.println(n),
        () -&gt; System.out.println("Nada")   );</code></pre></div></div>
<div class="listingblock source fragment"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">// Optional empty? → Build a new one on-the-fly…
var triedAgain = maybeInt.or( () -&gt; Optional.of(-1) );</code></pre></div></div>
<div class="listingblock source fragment"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">// Provide a stream → [] or [42]
Stream&lt;Integer&gt; intStream = maybeInt.stream();</code></pre></div></div>
<div class="listingblock source fragment"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">// Yay! – complements isPresent()
assert maybeInt.isPresent() == !maybeInt.isEmpty();</code></pre></div></div></div></section><section id="_new_processhandle_and_processbuilder"><h2>New <code>ProcessHandle</code> and <code>ProcessBuilder</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">Process sleeper = new ProcessBuilder("sleep", "10s").start();
ProcessHandle sleepHandle = sleeper.toHandle();

// Perform Runnables on process exit
sleepHandle.onExit().thenRun(                       // → CompletableFuture
        () -&gt; out.println("`sleep` process exited")  );

out.println(sleepHandle.info());
// → [user: ben, cmd: /bin/sleep, args: [10s], startTime:…, totalTime: …]

// Find …
ProcessHandle jvm = ProcessHandle.current();              // … JVM,
Stream&lt;ProcessHandle&gt; all = ProcessHandle.allProcesses(); // … all processes
jvm.children().forEach(out::println);                     // … or childs

// Kill …
sleepHandle.destroy();</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>much more convenient</p></li><li><p>provides <strong>more info</strong> and <strong>more control</strong></p></li><li><p>aid the creation of process pipelines</p></li></ul></div></aside></div></section><section id="_enhanced_deprecation_policy" class="left"><h2>Enhanced Deprecation policy</h2><div class="slide-content"><div class="listingblock"><div class="title"><code>@Deprecated</code> now wears a <code>forRemoval</code> flag</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">@Deprecated(since="1.2", forRemoval=true)
public final synchronized void stop(Throwable obj) {
    throw new UnsupportedOperationException();
}</code></pre></div></div>
<div class="openblock tgap fragment"><div class="content"><div class="listingblock x-small"><div class="title"><code>jdeprscan</code>: Scan Jars for deprecated usages</div>
<div class="content"><pre>$ jdeprscan commons-math3-3.6.1.jar
Jar file commons-math3-3.6.1.jar:
class org/apache/commons/math3/fraction/BigFraction uses deprecated method java/math/BigDecimal::divide(Ljava/math/BigDecimal;II)…;
class org/apache/commons/math3/util/MathUtils uses deprecated method java/lang/Double::&lt;init&gt;(D)V
class org/apache/commons/math3/util/Precision uses deprecated method java/math/BigDecimal::setScale(II)Ljava/math/BigDecimal;</pre></div></div>
<div class="paragraph"><p><span class="verydecent">can filter for deprecated methods marked for removal</span></p></div></div></div></div></section><section id="_stackwalker" class="bonuscontent"><h2>StackWalker</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">StackWalker.getInstance().walk(s -&gt;
        s.map( frame -&gt; frame.getClassName()+ '/' +frame.getMethodName() )
                .filter(name -&gt; name.startsWith("de.bentolor"))
                .limit(10)
                .collect(Collectors.toList())
).forEach(out::println);</code></pre></div></div></div></section><section id="_http2_client_jep_110_jep_321"><h2>HTTP/2 Client <span class="jep"><a href="https://openjdk.java.net/jeps/110">JEP 110</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/321">JEP 321</a></span></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">HttpClient client = HttpClient.newBuilder()                              <i class="conum" data-value="1"></i><b>(1)</b>
            .version(HttpClient.Version.HTTP_2)                          <i class="conum" data-value="2"></i><b>(2)</b>
            .connectTimeout(Duration.ofSeconds(3)).build();

URI uri = URI.create("https://www.exxcellent.de/");
HttpRequest req = HttpRequest.newBuilder(uri)
        .header("Useragent", "MyDemo").GET().build();

var future = client.sendAsync(req, HttpResponse.BodyHandlers.ofString()) <i class="conum" data-value="3"></i><b>(3)</b>
        .thenApply(HttpResponse::body)
        .thenAccept(System.out::println);

var expensiveOperation = Math.pow(12345, 9876);  // meanwhile do sth. else…
future.get();              // wait for completion of the background request</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><strong>Fluent API</strong> and <strong>Builder Pattern</strong></td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td><strong>Standardized HTTP client</strong> capable of <strong>HTTP/2</strong> and <strong>WebSocket</strong> connections!</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Start <strong>asynchronously</strong> HTTP requests in the background</td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>Standardized HTTP client capable of WebSocket connections!</p><div class="ulist"><ul><li><p>Java 8 UrlConnection too abstract</p></li><li><p>New client: Fluent API</p></li></ul></div></li><li><p>Support for asynchronous requests!</p></li><li><p>Support for Proxying, Cookies, Authentication</p></li></ul></div></aside></div></section><section id="_websocket_client" class="bonuscontent"><h2>WebSocket client</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">var wsBuilder = HttpClient.newHttpClient().newWebSocketBuilder();
var wsFuture = wsBuilder.buildAsync(URI.create("wss://echo.websocket.org"),

        new WebSocket.Listener() {
            onOpen(webSocket) { …  }
            onText(webSocket, data, last) { … }
            onBinary(webSocket, data,last) { … }
            onPing(webSocket, message) { … }
            onPong(webSocket, message) { … }
            onClose(webSocket, statusCode, reason) { … }
            onError(webSocket, error) { …  }
        });

WebSocket websocket = wsFuture.join();
websocket.sendText("Ping!", true);
websocket.sendClose(NORMAL_CLOSURE, "Goodbye!").join();</code></pre></div></div></div></section><section id="_reactive_streams"><h2>Reactive Streams</h2><div class="slide-content"><div class="paragraph"><p><code>java.util.concurrent.Flow</code></p></div>
<div class="paragraph"><p>JDK Standard of <a href="https://www.reactive-streams.org" class="bare">https://www.reactive-streams.org</a><br>
for <strong>asynchronous stream processing</strong><br>
with <strong>non-blocking backpressure</strong></p></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://github.com/reactive-streams/reactive-streams-jvm/blob/v1.0.2/README.md">Reactive Streams JVM Speciifcation</a></p></li></ul></div></div></div>
<aside class="notes"><div class="paragraph"><p>The main goal of Reactive Streams is to govern the exchange of stream data across an asynchronous boundary – think passing elements on to another thread or thread-pool — while ensuring that the receiving side is not forced to buffer arbitrary amounts of data.</p></div></aside></div></section><section id="_deprecation_of_finalize"><h2>Deprecation of <code>finalize()</code></h2><div class="slide-content"><div class="quoteblock"><div class="title">Motivation</div><blockquote><div class="paragraph"><p>Finalizers are inherently problematic and their use can lead to performance
issues, deadlocks, hangs, and other problematic behavior.</p></div></blockquote></div>
<div class="openblock pc70 left fragment"><div class="content"><div class="paragraph"><p>No <code>forRemoval=true</code> yet&#8201;&#8212;&#8201;probably for long!</p></div></div></div>
<div class="openblock pc70 left tgap decent fragment x-small"><div class="content"><div class="paragraph"><p>New way: Register <code>Cleaner</code> services for your objects.<br>
They will receive <code>PhantomReference</code> to objects which are no longer reachable.</p></div></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://bugs.openjdk.java.net/browse/JDK-8165641">JDK-8165641 Deprecate Object.finalize</a></p></li><li><p><a href="https://stuartmarks.wordpress.com/2017/04/17/deprecation-of-object-finalize/">Deprecation of Object.finalize()</a></p></li></ul></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Problem: Calling <code>finalize()</code> on an object allows it “resurrection” → GC problem</p></li><li><p>are <code>notforremoval</code> and probably for long. Port all JDK and then wait for important lcients to follow</p></li></ul></div></aside></div></section><section id="_string_enhancements" class="bonuscontent"><h2>String enhancements</h2><div class="slide-content"><div class="listingblock"><div class="title">Java 11: Adopting new <code>Character.isWhitespace()</code></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">" \tword\u0019 \r".trim()          // → "word";      (Java 8)

// New methods based on `Character.isWhitespace(char)`
" \tword\u0019 \r".strip()         // → "word\u0019"
" \tword\u0019 \r".stripLeading()  // → "word\u0019 \r"
" \tword\u0019 \r".stripTrailing() // → " \tword\u0019"
" \t".isBlank()                    // → true</code></pre></div></div>
<div class="listingblock"><div class="title">Java 12 utilities <span class="version">12</span></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">"hi\r\n  you!".indent(2)   // →  "  hi\n    you!\n");
"hi\r\n  you!".indent(-1)  // →  "hi\n you!\n");

Stream&lt;String&gt; l = "1\n2\n3\n!".lines();
IntStream stream = "word".chars();

"ABC".transform(String::toLowerCase), "abc");</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Indents: Obviously eat-your-own-dogfood Preparation to Text Block. More in 13</p></li></ul></div></aside></div></section><section id="_jdk_api_changes" class="small lightbg" data-background-video="videos/api-diff-scroll.mp4" data-background-opacity="0.6"><h2><span class="icon"><i class="fa fa-tags"></i></span> JDK API Changes</h2><div class="slide-content"><div class="paragraph"><p><a href="https://github.com/marchof/java-almanac">JDK API Changes Java Almanac</a></p></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p>Source: <a href="https://github.com/marchof/java-almanac">Java Almanac (Marc R. Hoffmann)</a></p></li><li><p><a href="https://github.com/AdoptOpenJDK/jdk-api-diff">Event more detailed API comparison</a></p></li></ul></div></div></div></div></section></section>
<section><section id="_tooling" class="lightbg" data-background-video="videos/hammer.mp4" data-background-video-loop data-background-opacity="0.7"><h2>Tooling</h2></section><section id="_repls_jshell_jep_222" data-background-size="contain" data-background-video="videos/jshell-demo.mp4"></section><section id="_repls_jshell_jep_222_2"><h2>REPLS: <code>jshell</code> <span class="jep"><a href="https://openjdk.java.net/jeps/222">JEP 222</a></span></h2><div class="slide-content"><div class="listingblock small col2"><div class="content"><pre>$ jshell
|  Welcome to JShell -- Version 13-ea
|  For an introduction type: /help intro

jshell&gt; "HI"
$1 ==&gt; "HI"

jshell&gt; var hi = $1.to
toCharArray()   toLowerCase(    toString()      toUpperCase(
jshell&gt; var hi = $1.toLowerCase()
hi ==&gt; "hi"

jshell&gt; String twice(String s) {
   ...&gt;    return s + s;
   ...&gt; }
|  created method twice(String)

jshell&gt; var hihi = twice(hi)
hihi ==&gt; "hihi"

jshell&gt; /vars
|    String $1 = "HI"</pre></div></div>
<div class="listingblock small col2"><div class="content"><pre>|    String hi = "hi"
|    String hihi = "hihi"

jshell&gt; /methods
|    String twice(String)

jshell&gt; /edit twice
|  modified method twice(String)

jshell&gt; /list

   1 : "HI"
   2 : var hi = $1.toLowerCase();
   4 : var hihi = twice(hi);
   5 : String twice(String s) {
          return "Double Time: "+ s + s;
       }

jshell&gt; /4
var hihi = twice(hi);
hihi ==&gt; "Double Time: hihi"

jshell&gt; /save twice twice.jsh</pre></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://docs.oracle.com/javase/10/jshell/introduction-jshell.htm">Java Shell User’s Guide</a></p></li><li><p><a href="https://www.pluralsight.com/guides/getting-started-with-jshell-part-2">Getting Started with JShell Part 2 &amp; 3</a></p></li></ul></div></div></div></div></section><section id="_single_source_file_launch_jep_330"><h2>Single Source File Launch <span class="jep"><a href="https://openjdk.java.net/jeps/330">JEP 330</a></span></h2><div class="slide-content"><div class="listingblock"><div class="title">Directly execute Java source in File <code>hello</code> (no <code>.java</code>-Suffix!)</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">#!/usr/bin/java --source 11

public class SingleClassJava {
    public static void main(String[] args) {
        System.out.println("Hello " + args[0] + ". Executable .java – Yay!");
    }
}</code></pre></div></div>
<div class="openblock fragment"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs" data-noescape="true">$ chmod +x hello
$ ./hello world
Hello world. Executable .java – Yay!</code></pre></div></div></div></div>
<div class="openblock fragment"><div class="content"><div class="paragraph"><p><span class="x-small decent">or launch any single-class Java file:</span></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs" data-noescape="true">$ java SingleClassJava.java world</code></pre></div></div></div></div></div></section><section id="_jvm_logging_log_rerouting" class="left"><h2>JVM Logging &amp; Log rerouting</h2><div class="slide-content"><div class="listingblock small"><div class="title">Fine-grained, easy-to-configure JVM Logging <span class="jep"><a href="https://openjdk.java.net/jeps/158">JEP 158</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/271">JEP 271</a></span></div>
<div class="content"><pre>$ java -Xlog:os="debug,gc*=debug:stdout:pid,level,tags" SingleClassJava.java

[30911][debug][os] Initial active processor count set to 4
[30911][info ][os] Use of CLOCK_MONOTONIC is supported
[30911][debug][gc,ergo,heap  ] Attempt heap expansion (allocate archive regions). Total size: …
[30911][info ][gc,cds        ] Mark closed archive regions in map: [0x00000007bff00000, … ]</pre></div></div>
<div class="openblock tgap fragment"><div class="content"><div class="paragraph"><div class="title">JVM Log rerouting <span class="jep"><a href="https://openjdk.java.net/jeps/264">JEP 264</a></span></div><p>Allows applications to provide <strong>custom logger</strong> implementations<br>
to be <strong>used by platform</strong> classes.</p></div></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://grokonez.com/java/java-9/java-9-platform-logging-and-service">Java 9 Platform Logging API and Service</a></p></li><li><p><a href="https://grokonez.com/java/java-9/java-9-unified-jvm-logging">Java 9 Unified JVM Logging</a></p></li></ul></div></div></div></div></section><section id="_flight_recorder_jep_328"><h2>Flight Recorder <span class="jep"><a href="https://openjdk.java.net/jeps/328">JEP 328</a></span></h2><div class="slide-content"><div class="paragraph"><p><span class="image" style="float: right"><img src="images/java-mission-control-center.png" alt="Java Mission Control" width="800"></span></p></div>
<div class="ulist"><ul><li><p><span class="icon"><i class="fa fa-cogs"></i></span> <strong>Production</strong>-<br>
Profiling &amp; Monitoring</p></li><li><p>Former Oracle payware <br>
Open-sourced with Java 11</p></li><li><p><em>Flight recording</em> start<br>
on new &amp; running <code>java</code></p></li><li><p>Rules → Alerts</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>low-overhead  !</p></li><li><p>previously a commercial addition to the JVM, now open-sourced, part of Java 11</p></li><li><p><code>java -XX:StartFlightRecording=settings=default nl.craftsmen.java11demo.MyClass</code></p></li></ul></div></aside>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="http://jdk.java.net/jmc/" class="bare">http://jdk.java.net/jmc/</a></p></li></ul></div></div></div></div></section><section id="_microbenchmark_suite_jep_230_12"><h2>Microbenchmark Suite <span class="jep"><a href="https://openjdk.java.net/jeps/230">JEP 230</a></span> <span class="version">12</span></h2><div class="slide-content"><div class="openblock col3-lc"><div class="content"><div class="listingblock small source"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.MICROSECONDS)
@State(Scope.Thread)
public class BenchmarkIntegers {
    @Param("500")
    private int size;
    private String[] strings;

    @Setup
    public void setup() {
        Random r = new Random(0);
        strings = new String[size];
        for (int i = 0; i &lt; size; i++) {
            strings[i] = "" + (r.nextInt(10000) - 5000);
        }
    }

    @Benchmark
    public void parseInt(Blackhole bh) {
        for (String s : strings) {
            bh.consume(Integer.parseInt(s));
        }
    }
}</code></pre></div></div></div></div>
<div class="openblock col3-r small"><div class="content"><div class="ulist"><ul><li><p>Based on <code>jmh</code></p></li><li><p>Avoids JIT Falltrips</p></li><li><p>Start via Maven Archteype</p></li></ul></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Microbenchmarking: Falltrip JIT Compiler</p></li></ul></div></aside></div></section><section id="_jlink_jdeps_jep_282_jep_220_jep_275_jep_200_jep_201_jep_260" class="left"><h2><code>jlink</code> / <code>jdeps</code> <span class="jep"><a href="https://openjdk.java.net/jeps/282">JEP 282</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/220">JEP 220</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/275">JEP 275</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/200">JEP 200</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/201">JEP 201</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/260">JEP 260</a></span></h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p><strong>Most interesting Part of Java 9 / Jigsaw!</strong></p></div></blockquote></div>
<div class="paragraph tgap"><div class="title">Minimize size with <code>jlink</code> Linker</div><p><span class="x-small">Build optimized, slim run-time image for modular Java application with minimal JRE</span></p></div>
<div class="paragraph"><div class="title">List package dependencies with <code>jdeps</code></div><p><span class="x-small"><code>jdeps app.jar</code></span></p></div>
<div class="openblock fragment"><div class="content"><div class="paragraph"><div class="title">+ better Container-Awareness</div><p><span class="x-small">Support of <strong>Docker</strong> CPU and memory limits.</span></p></div></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="http://cr.openjdk.java.net/~mr/jigsaw/ea/module-summary.html">JVM Module Summary</a></p></li><li><p><a href="http://openjdk.java.net/projects/jigsaw/spec/sotms/">The State of the Module System</a></p></li><li><p><a href="https://docs.oracle.com/en/java/javase/12/tools/jdeps.html">jdeps Manual</a></p></li><li><p><a href="https://bugs.openjdk.java.net/browse/JDK-8146115">JDK-8146115[Improve docker container detection</a></p></li></ul></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Java 8 is not aware of being executed in a Docker container: Misinterpretation of available CPU / Memory can cause excessive CPU context switches, Thread contention, Memory overcomitting</p></li></ul></div></aside></div></section><section id="_packaging" class="left"><h2>Packaging</h2><div class="slide-content"><div class="paragraph"><div class="title"><span class="icon"><i class="fa fa-book-dead"></i></span> Cross compilation with <code>javac --release N</code> <span class="jep"><a href="https://openjdk.java.net/jeps/247">JEP 247</a></span></div><p>Conveniently compile for older Java with <code>--release</code><br>
<span class="decent">Replaces: <code>javac -source N -target N –bootclasspath rtN.jar</code></span></p></div>
<div class="openblock tgap fragment"><div class="content"><div class="paragraph"><div class="title"><span class="icon"><i class="fa fa-cube"></i></span> Packaging: Multi-release JAR <span class="jep"><a href="https://openjdk.java.net/jeps/238">JEP 238</a></span></div><p>JAR Files can now contain multiple, version-specific versions classes</p></div></div></div></div></section><section id="_html5_javadoc_jep_221_jep_224_jep_225" class="bonuscontent"><h2>HTML5 Javadoc <span class="jep"><a href="https://openjdk.java.net/jeps/221">JEP 221</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/224">JEP 224</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/225">JEP 225</a></span></h2><div class="slide-content"><div class="ulist"><ul><li><p>Enable via <code>-html5</code> parameter</p></li><li><p>Search box for easy navigation</p></li><li><p>HTML5 output; no more frames</p></li><li><p>Improved DocLint: <code>-Xdoclint/package:java.<strong>,javax.</strong></code></p></li></ul></div></div></section><section id="_performance" class="bonuscontent"><h2>Performance</h2><div class="slide-content"><div class="ulist"><div class="title">Compact Strings <span class="jep"><a href="https://openjdk.java.net/jeps/254">JEP 254</a></span></div><ul><li><p>Use ISO-8869-1 (1 byte/character) when possible</p></li></ul></div>
<div class="ulist"><div class="title">Garbage Collector G1 <span class="jep"><a href="https://openjdk.java.net/jeps/248">JEP 248</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/307">JEP 307</a></span></div><ul><li><p>Now default GC</p></li><li><p>Multi-threaded Full GCs</p></li><li><p>Minimzes Stop-the-world Pauses</p></li><li><p>Deduplicates String</p></li></ul></div>
<div class="ulist"><div class="title">Epsilon GC</div><ul><li><p>No-Op Garbage Collector (short-living JVMs)</p></li></ul></div></div></section></section>
<section><section id="_java_14_beyond" class="lightbg" data-background-video="videos/prediction.mp4" data-background-video-loop data-background-opacity="1"><h2>Java 14 &amp; beyond</h2></section><section id="_project_metropolis"><h2>Project Metropolis</h2><div class="slide-content"><div class="imageblock" style=""><img src="images/graalvm-architecture.png" alt="GraalVM ecosystem"></div>
<aside class="notes"><div class="ulist"><ul><li><p>Polyglot VM: Execute multiple language with zero overhead</p></li><li><p>Can run in multiple environments; Can produce native images</p></li><li><p>Zero-overhead interop</p></li></ul></div></aside></div></section><section id="_graalvmpolyglot_vm_jep_243_jep_246_jep_295"><h2>GraalVM&#8201;&#8212;&#8201;Polyglot VM <span class="jep"><a href="https://openjdk.java.net/jeps/243">JEP 243</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/246">JEP 246</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/295">JEP 295</a></span></h2><div class="slide-content"><div class="openblock col2"><div class="content"><div class="ulist"><ul><li><p><strong>Ahead-of time compiler</strong> (AoT)</p></li><li><p>Generic VM<br>
 for <strong>different languages</strong><br>
→ <em>JVM</em> (Java, Kotlin, Scala, …)<br>
→ <em>LLVM</em> (C, C++) → native<br>
→ <em>Java</em> Script, Python, Ruby, R</p></li></ul></div></div></div>
<div class="openblock col2"><div class="content"><div class="ulist"><ul><li><p>Shared Runtime → Zero overhead for language interop</p></li><li><p><strong>Native executables</strong><br>
(GraalVM on SubstrateVM)<br>
→ Much smaller startup &amp; memory</p></li></ul></div></div></div>
<div class="openblock clear decent"><div class="content"><div class="paragraph"><div class="title">AoT can be used today:</div><p><span class="x-small"><code>java -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI -XX:+UseJVMCICompiler</code></span></p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Multiple parts:</p><div class="ulist"><ul><li><p>AoT Compiler</p></li><li><p>Graal VM / Substrate VM as runtime</p></li></ul></div></li><li><p>AoT → improved startup time vs. JIT</p></li><li><p>Limitations: Dynamic (Reflection); highly experimental</p></li><li><p>AoT Compile can be used today</p></li></ul></div></aside></div></section><section id="_simplyfing_syntax_amber"><h2>Simplyfing Syntax: Amber</h2><div class="slide-content"><div class="listingblock"><div class="title">Pattern matching for <code>instanceof</code> <span class="jep"><a href="https://openjdk.java.net/jeps/305">JEP 305</a></span></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">if (obj instanceof String s) {
    return s.contains("abc")
}</code></pre></div></div>
<div class="listingblock"><div class="title">Unamed lamda parameters <span class="jep"><a href="https://openjdk.java.net/jeps/302">JEP 302</a></span></div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">(i, _) -&gt; String.valueOf(i);</code></pre></div></div>
<div class="listingblock"><div class="title">Data Classes &amp; Sealed Types</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">record Point(int x, int y) { }</code></pre></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://openjdk.java.net/projects/amber/">OpenJDK Project Amber</a></p></li><li><p><a href="https://cr.openjdk.java.net/~briangoetz/amber/datum.html">Data Classes and Sealed Types for Java</a></p></li></ul></div></div></div></div></section><section id="_value_types_valhalla"><h2>Value Types: Valhalla</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>JVM infrastructure for working with <strong>immutable</strong> and <strong>reference-free</strong> objects,
for efficient by-value computation with non-primitive types.</p></div></blockquote></div>
<div class="openblock tgap"><div class="content"><div class="listingblock"><div class="title">Value Object: Immutable &amp; Final</div>
<div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">value class Rectangle { int width,height; }</code></pre></div></div></div></div>
<div class="openblock decent tgap small"><div class="content"><div class="paragraph"><p><em>t(L1(/L2 Cache)</em> &lt;&lt; <em>t(RAM)</em>: → Similar performance to primitives<br>
Benefits of immutables: Functional-style computations, shareability, …</p></div></div></div>
<div class="openblock refs"><div class="content"><div class="ulist"><ul><li><p><a href="https://openjdk.java.net/projects/valhalla/">OpenJDK Valhalla</a></p></li></ul></div></div></div></div></section><section id="_loom_fibers_continuations"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="images/loom_banner1.png" alt="Loom: Fibers &amp; Continuations"></span></p></div>
<div class="openblock col3-l"><div class="content"><div class="ulist"><div class="title">Lightweight concurrency</div><ul><li><p>Continuations</p></li><li><p>Fibers (JVM „threads“)</p></li><li><p>Tail-call elimination</p></li></ul></div></div></div>
<div class="openblock col3-cr"><div class="content"><div class="listingblock source small"><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs" data-noescape="true">Continuation cont = new Continuation(SCOPE, () -&gt; {
    while (true) {
        System.out.println("before");
        Continuation.yield(SCOPE);
        System.out.println("after");
    }
});

while (!cont.isDone()) {
    cont.run();
}</code></pre></div></div>
<div class="paragraph"><p><span class="decent xx-small">Similar to cooperative multitasking or Kotlin&#8217;s Coroutines…</span></p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>User-mode "threads": No real theads &amp; overhead</p></li><li><p>Continuations / Cooperative Multitasking: Tasks indicate when they want togive up control</p></li><li><p>Easily scales to 100.000 of parallel tasks</p></li></ul></div></aside></div></section></section>
<section id="_bottom_line" data-background-image="images/tweet-jdk-evolving.png"><div class="slide-content"><aside class="notes"><div class="ulist"><ul><li><p>Geändertes Modell hat das Potential schnellere Features auch im Einsatz zu sehen
Generell: <strong>„Neuer Wind“ = Gute &amp; überfällige Sache</strong>:</p><div class="olist arabic"><ol class="arabic"><li><p>Java wird wieder moderner. Die JVM war immer zeitgemäß</p></li><li><p>Schnellere Änderungen; <strong>Kampf gegen: "Java das neue COBOL!"</strong></p></li></ol></div></li><li><p>Try to get on the release train now!  <strong>Just run: It might just work</strong></p></li><li><p>Many things devs want. But how convince management? → <strong>Saving Money!</strong> (Performance, Licence, Recruiting)</p></li><li><p>Adress compiler warnings: More seriously. Deprecation warnings will become true!</p></li></ul></div></aside></div></section>
<section><section id="_resources" class="lightbg" data-background-video="videos/industrial.mp4" data-background-video-loop data-background-opacity="0.6"><h2>Resources</h2><div class="slide-content"><div class="openblock col3-l xx-small"><div class="content"><div class="ulist"><div class="title">References</div><ul><li><p><a href="https://github.com/marchof/java-almanac">JDK API Changes Java Almanac</a></p></li><li><p><a href="https://chriswhocodes.com/vm-options-explorer.html">VM Options Explorer for HotSpot, Graal, OpenJ9, Xing</a></p></li></ul></div>
<div class="ulist"><div class="title">Articles</div><ul><li><p><a href="https://medium.com/@javachampions/java-is-still-free-2-0-0-6b9aa8d6d244">Java is Still Free 2.0.3</a></p></li><li><p><a href="https://blogs.oracle.com/java-platform-group/oracle-jdk-releases-for-java-11-and-later">Oracle Blog: Oracle JDK</a></p></li><li><p><a href="https://www.pluralsight.com/guides/getting-started-with-jshell-part-2">Getting Started with <code>jshell</code> Part 2 &amp; 3</a></p></li></ul></div>
<div class="ulist"><div class="title">OpenJDK Suppliers</div><ul><li><p><a href="https://adoptopenjdk.net/">AdoptOpenJDK</a>
<a href="https://access.redhat.com/articles/1299013">Red Hat</a>
<a href="https://aws.amazon.com/corretto/">Amazon Corretto</a>,
<a href="https://github.com/alibaba/dragonwell8">Alibaba</a>,
<a href="https://www.azul.com/products/zulu-enterprise/">Azul Zulu</a>,
<a href="https://github.com/SAP/SapMachine">SAP</a>,
<a href="https://www.ibm.com/marketplace/support-for-runtimes">IBM</a>,
<a href="https://bell-sw.com/java.html">BellSoft</a>,
<a href="https://www.jclarity.com/">jClarity</a></p></li></ul></div>
<div class="ulist"><div class="title">Tools</div><ul><li><p><a href="https://www.graalvm.org/">GraalVM</a></p></li><li><p><a href="http://jdk.java.net/jmc/">Flight Recorder/Mission Control Center (EAP)</a></p></li></ul></div></div></div><div class="openblock col3-c xx-small"><div class="content"><div class="ulist"><div class="title">Contact</div><ul><li><p>Twitter <a href="https://twitter.com/bentolor"><strong>@bentolor</strong></a></p></li><li><p>Email: <a href="mailto:benjamin.schmid@exxcellent.de">benjamin.schmid@exxcellent.de</a></p></li></ul></div>
<div class="ulist"><div class="title">Sources</div><ul><li><p><span class="icon"><i class="fa fa-code-branch fa-Github"></i></span> <a href="https://github.com/bentolor/java9to13"><strong>GitHub Repo with Source Code Examples &amp; Slide Sources</strong></a></p></li></ul></div>
<div class="ulist"><div class="title">Image &amp; Video Source</div><ul><li><p><a href="https://de.freeimages.com/photographer/s_lim363-49742">Background image</a>,
<a href="https://www.pexels.com/video/a-bee-on-a-yellow-flower-2048452/">Flowers</a>, <a href="https://www.pexels.com/video/relaxing-at-the-beach-1449880/">Relaxing at the beach</a>, <a href="https://www.pexels.com/video/cup-of-coffee-on-top-of-coffee-beans-855414/">Coffee Beans</a>, <a href="https://www.pexels.com/video/close-up-video-of-a-woman-studying-855418/">Woman studying</a>, <a href="https://www.pexels.com/video/white-keyboard-2219383/">White keyboard</a>, <a href="https://www.pexels.com/video/jack-hammering-pavement-855956/">Jackhammer</a>, <a href="https://www.pexels.com/video/globe-plasma-light-1192113/">Plasma Light</a>, <a href="https://www.pexels.com/video/heavy-equipment-loading-cement-2073130/">Industrial Site</a></p></li></ul></div></div></div><div class="openblock col3-r small"><div class="content"><div class="paragraph"><p><strong>These slides with all links</strong>
<span class="image"><img src="images/bentolor-java913-url-qrcode.png" alt="https://bentolor.github.io/java9to13/"></span><br>
<span class="emphasize"><strong><a href="https://bit.ly/2KPvyZh" class="bare">https://bit.ly/2KPvyZh</a></strong></span></p></div></div></div></div></section><section id="_cleanups" class="bonuscontent"><h2>Cleanups</h2><div class="slide-content"><div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">JDK: Cleanup</div><ul><li><p><strong>Java EE removed</strong></p></li><li><p><strong>CORBA removed</strong></p></li><li><p>Internal API’s (<code>sun.*</code>) removed / deprecated</p></li><li><p><code>apple.applescript</code> &amp; <code>com.apple</code> removed</p></li><li><p>Disable X.509/SHA-1 certificate chains</p></li><li><p>Remove Launch-Time JRE Version Selection directives</p></li><li><p><strong>Removed <code>Thread.destroy()</code> and <code>Thread.stop()</code></strong></p></li><li><p>Deprecate Applet API</p></li><li><p>Deprecate Nashorn Javascript Engine</p></li><li><p><strong>Deprecate Object.finalize()</strong></p></li></ul></div></div></div>
<div class="openblock col2 x-small"><div class="content"><div class="ulist"><div class="title">Language: Cleanup</div><ul><li><p><code>var</code> &amp; <code>_</code> no longer a valid identifier</p></li></ul></div>
<div class="ulist"><div class="title">Tooling/JVM: Cleanup</div><ul><li><p>Remove <code>jhat</code></p></li><li><p>Remove hprof Agent</p></li><li><p>Remove old GC Combinations</p></li><li><p>Remove <code>javah</code></p></li><li><p>Remove <code>lib/endorsed</code>  &amp; <code>lib/ext</code></p></li><li><p><strong>Replace rt.jar</strong></p></li><li><p>ResourceBundle loads properties files in UTF-8 instead of ISO-8859-1</p></li><li><p>Deprecate CMS GC</p></li><li><p>Deprecate Pack200</p></li></ul></div></div></div></div></section><section id="_security_tls_crypto" class="bonuscontent"><h2>Security / TLS / Crypto</h2><div class="slide-content"><div class="ulist"><ul><li><p>Validate Incoming Serialization Data
JDK 9</p></li><li><p>Default keystore type is the standard PKCS12 instead of the proprietary JKS
JDK 9</p></li><li><p>Default set of root Certification Authority (CA) certificates are provided with the JDK, so TLS connections are working out of the box
JDK 10</p></li><li><p>DRBG-Based SecureRandom
JDK 9</p></li><li><p>Disable X.509 certificate chains with SHA-1 based signatures
JDK 9</p></li><li><p>SHA-3 Hash Algorithms
JDK 9</p></li><li><p>TLS 1.3 support
JDK 11</p></li><li><p>API for Datagram Transport Layer Security (DTLS)
JDK 9</p></li><li><p>OCSP stapling TLS to improve performance of certificate status checking
JDK 9</p></li><li><p>TLS Application-Layer Protocol Negotiation (ALPN) Extension which enables protocol negotiation without additional round trips; ALPN is a requirement for HTTP/2 connections
JDK 9</p></li><li><p>Key Agreement with Curve25519 and Curve448
JDK 11</p></li><li><p>ChaCha20 and Poly1305 Cryptographic Algorithms
JDK 11</p></li></ul></div></div></section><section id="_internationalization" class="bonuscontent"><h2>Internationalization</h2><div class="slide-content"><div class="ulist"><ul><li><p>ResourceBundle loads properties files <em>by default</em> in UTF-8 instead of ISO-8859-1.<br>
Overide via system property <code>java.util.PropertyResourceBundle.encoding</code> <span class="jep"><a href="https://openjdk.java.net/jeps/226">JEP 226</a></span></p></li><li><p>Unicode 10.0, adding roughly 27.000 characters, 10 blocks, and more than 30 scripts. <span class="jep"><a href="https://openjdk.java.net/jeps/267">JEP 267</a></span> <span class="jep"><a href="https://openjdk.java.net/jeps/327">JEP 327</a></span></p></li><li><p>java.util.Locale and related APIs support currency type, time zone and more. <span class="jep"><a href="https://openjdk.java.net/jeps/314">JEP 314</a></span></p></li><li><p><code>Locale</code>-specific operations now uses by default data provided by Unicode, no longer Oracle-provided. <span class="jep"><a href="https://openjdk.java.net/jeps/252">JEP 252</a></span></p></li></ul></div></div></section><section id="_graphics_and_desktop_applications" class="bonuscontent"><h2>.Graphics and Desktop Applications</h2><div class="slide-content"><div class="ulist"><ul><li><p>Desktop features for all platforms like login/logout/lock event listener and task bar interactions
JDK 9</p></li><li><p>MultiResolutionImage that makes easy to retrieve a resolution-specific image for a DPI
JDK 9</p></li><li><p>HiDPI Graphics on Windows and Linux
JDK 9 <a href="https://openjdk.java.net/jeps/263" class="bare">https://openjdk.java.net/jeps/263</a></p></li><li><p>Enable GTK 3 on Linux for JavaFX, Swing, and AWT
JDK 9 <a href="https://openjdk.java.net/jeps/283" class="bare">https://openjdk.java.net/jeps/283</a></p></li><li><p>Replace @beaninfo Javadoc tags with @BeanInfo annotations for Swing
JDK 9</p></li><li><p>Update GStreamer included in JavaFX/Media to version 1.4.4
JDK 9</p></li><li><p>Replace the existing ICU OpenType font-layout engine with HarfBuzz
JDK 9</p></li></ul></div>
<script src="./live.js"></script>

<!-- hide "verbatim" sections if URL contains "terse"-Keyword -->
<script>
/*
    if (!window.location.search.match(/bonus/gi)) {
        var sections = document.getElementsByTagName('section');
        for (var i = sections.length-1; i > -1; --i) {
            console.log(sections[i].classList);
            if (sections[i].classList.contains("bonuscontent")) {
                sections[i].remove();
            }
        }
    }
*/
</script></div></section></section></div></div><script src="reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'edges',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'c/t',
  // Control which views the slide number displays on
  showSlideNumber: 'speaker',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: true,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 42,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 5,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: 'images/background-landscape-light-orange.jpg',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '4936px 2092px',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1408,
  height: 792,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(1408, 792)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(1408, 792)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(1408, 792)
});</script><link rel="stylesheet" href="css/atom-one-light.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function() {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( document.querySelectorAll( '.reveal pre code' ) ).forEach( function( block ) {

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightBlock( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightBlock( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );
          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.initHighlightingOnLoad();
</script></body></html>